<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>PyTorch-DP · Train PyTorch models with Differential Privacy</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Train PyTorch models with Differential Privacy"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="PyTorch-DP · Train PyTorch models with Differential Privacy"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebookresearch.github.io/pytorch-dp//"/><meta property="og:description" content="Train PyTorch models with Differential Privacy"/><meta property="og:image" content="https://facebookresearch.github.io/pytorch-dp/img/pytorch-dp-icon.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://facebookresearch.github.io/pytorch-dp/img/pytorch-dp_logo.png"/><link rel="shortcut icon" href="/img/pytorch-dp.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-139570076-2', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code_block_buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/code_block_buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/mathjax.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/pytorch-dp_logo.png" alt="PyTorch-DP"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class=""><a href="/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/api/" target="_self">API Reference</a></li><li class=""><a href="https://github.com/facebookresearch/pytorch-dp" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div>
<script type="text/javascript" id="documentation_options" data-url_root="./"
  src="/js/documentation_options.js"></script>
<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/underscore.js"></script>
<script type="text/javascript" src="/js/doctools.js"></script>
<script type="text/javascript" src="/js/language_data.js"></script>
<script type="text/javascript" src="/js/searchtools.js"></script>
<div class="sphinx"><div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-torchdp.autograd_grad_sample">
<span id="autograd-grad-sample"></span><h1>Autograd Grad Sample<a class="headerlink" href="#module-torchdp.autograd_grad_sample" title="Permalink to this headline">¶</a></h1>
<p><em>Based on</em> <a class="reference external" href="https://github.com/cybertronai/autograd-hacks">https://github.com/cybertronai/autograd-hacks</a></p>
<p>This module provides functions to capture per-sample gradients by using hooks.</p>
<p class="rubric">Notes</p>
<p>The <code class="docutils literal notranslate"><span class="pre">register_backward_hook()</span></code> function has a known issue being tracked at
<a class="reference external" href="https://github.com/pytorch/pytorch/issues/598">https://github.com/pytorch/pytorch/issues/598</a>. However, it is the only known
way of implementing this as of now (your suggestions and contributions are
very welcome). The behaviour has been verified to be correct for the layers
currently supported by pytorch-dp.</p>
<dl class="py function">
<dt id="torchdp.autograd_grad_sample.add_hooks">
<code class="sig-prename descclassname">torchdp.autograd_grad_sample.</code><code class="sig-name descname">add_hooks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">loss_reduction</span><span class="o">=</span><span class="default_value">'mean'</span></em>, <em class="sig-param"><span class="n">batch_first</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torchdp/autograd_grad_sample.html#add_hooks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torchdp.autograd_grad_sample.add_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds hooks to model to save activations and backprop values.
The hooks will</p>
<ol class="arabic simple">
<li><p>save activations into <code class="docutils literal notranslate"><span class="pre">param.activations</span></code> during forward pass.</p></li>
</ol>
<p>2. compute per-sample gradients and save them in <code class="docutils literal notranslate"><span class="pre">param.grad_sample</span></code>
during backward pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>nn.Module</em>) – Model to which hooks are added.</p></li>
<li><p><strong>loss_reduction</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Indicates if the loss reduction (for aggregating the gradients)
is a sum or a mean operation. Can take values <code class="docutils literal notranslate"><span class="pre">sum</span></code> or <code class="docutils literal notranslate"><span class="pre">mean</span></code>.
Default value is <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p></li>
<li><p><strong>batch_first</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Flag to indicate if the input tensor to the corresponding module
has the first dimension represent the batch, for example of shape
<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">...,</span> <span class="pre">...]</span></code>. Set to True if batch appears in first
dimension else set to False (<code class="docutils literal notranslate"><span class="pre">batch_first=False</span></code> implies that the
batch is always in the second dimension).
Default value is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="torchdp.autograd_grad_sample.disable_hooks">
<code class="sig-prename descclassname">torchdp.autograd_grad_sample.</code><code class="sig-name descname">disable_hooks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torchdp/autograd_grad_sample.html#disable_hooks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torchdp.autograd_grad_sample.disable_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Globally disables all hooks installed by this library.</p>
</dd></dl>
<dl class="py function">
<dt id="torchdp.autograd_grad_sample.enable_hooks">
<code class="sig-prename descclassname">torchdp.autograd_grad_sample.</code><code class="sig-name descname">enable_hooks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/torchdp/autograd_grad_sample.html#enable_hooks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torchdp.autograd_grad_sample.enable_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Globally enables all hooks installed by this library.</p>
</dd></dl>
<dl class="py function">
<dt id="torchdp.autograd_grad_sample.is_supported">
<code class="sig-prename descclassname">torchdp.autograd_grad_sample.</code><code class="sig-name descname">is_supported</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">layer</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torchdp/autograd_grad_sample.html#is_supported"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torchdp.autograd_grad_sample.is_supported" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the <code class="docutils literal notranslate"><span class="pre">layer</span></code> is supported by this library.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>layer</strong> (<em>nn.Module</em>) – Layer for which we need to determine if the support for capturing
per-sample gradients is available.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether the <code class="docutils literal notranslate"><span class="pre">layer</span></code> is supported by this library.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)">bool</a></p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="torchdp.autograd_grad_sample.remove_hooks">
<code class="sig-prename descclassname">torchdp.autograd_grad_sample.</code><code class="sig-name descname">remove_hooks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/torchdp/autograd_grad_sample.html#remove_hooks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#torchdp.autograd_grad_sample.remove_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes hooks added by <code class="docutils literal notranslate"><span class="pre">add_hooks()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>model</strong> (<em>nn.Module</em>) – Model from which hooks are to be removed.</p>
</dd>
</dl>
</dd></dl>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyTorch-DP</a></h1>
<h3>Navigation</h3>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="privacy_engine.html">PrivacyEngine</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy_analysis.html">Privacy Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="per_sample_gradient_clip.html">PerSampleGradientClipper</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Autograd Grad Sample</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_dp_sgd_privacy.html">Compute DP-SGD Privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="dp_multihead_attention.html">DPMultiheadAttention</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_utils.html">Tensor Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">Stats</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
<li><a href="index.html">Documentation overview</a><ul>
<li>Previous: <a href="per_sample_gradient_clip.html" title="previous chapter">PerSampleGradientClipper</a></li>
<li>Next: <a href="compute_dp_sgd_privacy.html" title="next chapter">Compute DP-SGD Privacy</a></li>
</ul></li>
</ul>
</div>
<div id="searchbox" role="search" style="display: none">
<h3 id="searchlabel">Quick search</h3>
<div class="searchformwrapper">
<form action="search.html" class="search" method="get">
<input aria-labelledby="searchlabel" name="q" type="text"/>
<input type="submit" value="Go"/>
</form>
</div>
</div>
<script>$('#searchbox').show(0);</script>
</div>
</div>
<div class="clearer"></div>
</div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div class="footerSection"><h5>Docs</h5><a href="/docs/introduction">Introduction</a><a href="/docs/faq">FAQ</a><a href="/tutorials/">Tutorials</a><a href="/api/">API Reference</a></div><div class="footerSection"><h5>Social</h5><div class="social"><a class="github-button" href="https://github.com/facebookresearch/pytorch-dp" data-count-href="https://github.com/facebookresearch/pytorch-dp/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star PyTorch-DP on GitHub">pytorch-dp</a></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright"> Copyright © 2020 Facebook Inc.</section><script>
            (function() {
              var BAD_BASE = '/pytorch-dp/';
              if (window.location.origin !== 'https://facebookresearch.github.io/pytorch-dp/') {
                var pathname = window.location.pathname;
                var newPathname = pathname.slice(pathname.indexOf(BAD_BASE) === 0 ? BAD_BASE.length : 1);
                var newLocation = 'https://facebookresearch.github.io/pytorch-dp//' + newPathname;
                console.log('redirecting to ' + newLocation);
                window.location.href = newLocation;
              }
            })();
          </script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '207c27d819f967749142d8611de7cb19',
                indexName: 'pytorch-dp',
                inputSelector: '#search_input_react'
              });
            </script></body></html>